{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Dashboard{% endblock title %}</title>
  
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
  
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  {% block extra_css %}{% endblock extra_css %}
</head>
<body>

  <!-- ✅ HERO VIDEO BACKGROUND SECTION -->
  <section class="hero-section">
    <video autoplay muted loop class="hero-video">
      <source src="{% static 'videos/login_background.mp4' %}" type="video/mp4">
    </video>

    <div class="hero-overlay"></div>

    <div class="hero-content">
      <h1 class="bounce-letters" id="heroHeading">Shape What the World Sees</h1>
      <p>Bring your brand's true identity forward — beautifully and boldly.</p>
    </div>
  </section>

  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <img src="{% static 'images/logo.png' %}" alt="Logo" class="sidebar-logo">
      </div>

     <ul class="menu" id="menu">
          <li class="menu-item {% if current_page == 'home' %}active{% endif %}">
              <a href="{% url 'home' %}?page=home"><i class='bx bxs-home'></i> Home</a>
          </li>
          <li class="menu-item {% if current_page == 'package' %}active{% endif %}">
              <a href="{% url 'package' %}?page=package"><i class='bx bx-package'></i> Package</a>
          </li>
          <li class="menu-item {% if current_page == 'franchise' %}active{% endif %}">
              <a href="{% url 'home' %}?page=franchise"><i class='bx bx-store-alt'></i> Franchise</a>
          </li>
          <li class="menu-item {% if current_page == 'contact' %}active{% endif %}">
              <a href="{% url 'home' %}?page=contact"><i class='bx bxs-contact'></i> Contact</a>
          </li>
      </ul>

    </aside>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- MAIN CONTENT -->
    <div class="content">

      <!-- ✅ TRANSPARENT TOPBAR -->
      <header class="topbar">
        <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu"><i class='bx bx-menu'></i></button>

        <div class="topbar-left">
          <strong id="currentPageLabel">{{ current_page|title }}</strong>

        </div>

        <div class="top-right">
          <div class="profile-wrapper" id="profileWrapper" tabindex="0">
           {% if user.profile.photo %}
                <img src="{{ user.profile.photo.url }}" 
                    alt="Profile Photo" class="profile-img" id="profilePreview">
            {% else %}
                <img src="{% static 'images/default.png' %}" 
                    alt="Default Profile" class="profile-img" id="profilePreview">
            {% endif %}


            <div class="profile-name">{{ user.username }}</div>
            <i class='bx bx-chevron-down'></i>

            <div class="dropdown" id="profileDropdown">

                <label class="upload-label" for="profileUpload">
                    <i class='bx bx-camera'></i> 
                    {% if user.profile.photo %}
                        Change Profile Photo
                    {% else %}
                        Upload Profile Photo
                    {% endif %}

                </label>

                <input type="file" id="profileUpload" accept="image/*" style="display:none" />

                <a href="{% url 'logout' %}" class="logout-link">
                    <i class='bx bx-log-out'></i> Logout
                </a>

            </div>

          </div>
        </div>
      </header>

      <!-- ✅ CHILD CONTENT WILL SHOW HERE -->
      {% block content %}
      {% endblock content %}

    </div>
  </div>

<!-- ✅ All Scripts Stay Same -->
<script>
  // -------------------- TOPBAR SCROLL EFFECT --------------------
  const topbar = document.querySelector(".topbar");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) topbar.classList.add("scrolled");
    else topbar.classList.remove("scrolled");
  });

  // -------------------- CARD ANIMATION ON VIEW --------------------
  const animatedElements = document.querySelectorAll(".card-animation");
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) entry.target.classList.add("animate-in");
    });
  }, { threshold: 0.2 });
  animatedElements.forEach(el => observer.observe(el));

  // -------------------- PROFILE DROPDOWN --------------------
  const profileWrapper = document.getElementById('profileWrapper');
  const profileDropdown = document.getElementById('profileDropdown');

  profileWrapper.addEventListener("click", e => {
    e.stopPropagation();
    profileDropdown.classList.toggle("show");
  });

  document.addEventListener("click", e => {
    if (!profileWrapper.contains(e.target)) {
      profileDropdown.classList.remove("show");
    }
  });

  // -------------------- PROFILE UPLOAD PREVIEW --------------------
  const profileUpload = document.getElementById("profileUpload");
  const profilePreview = document.getElementById("profilePreview");
  profileUpload?.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => profilePreview.src = reader.result;
    reader.readAsDataURL(file);
  });

  // -------------------- SIDEBAR TOGGLE --------------------
  const menuToggle = document.getElementById('menuToggle');
  const sidebar = document.getElementById('sidebar');
  const sidebarOverlay = document.getElementById('sidebarOverlay');

  function openSidebar() {
    sidebar.classList.add("open");
    sidebarOverlay.classList.add("active");
  }

  function closeSidebar() {
    sidebar.classList.remove("open");
    sidebarOverlay.classList.remove("active");
  }

  function toggleSidebar() {
    sidebar.classList.contains("open") ? closeSidebar() : openSidebar();
  }

  menuToggle.addEventListener("click", e => {
    e.stopPropagation();
    toggleSidebar();
  });

  // Close sidebar when clicking overlay
  sidebarOverlay.addEventListener("click", closeSidebar);

  // Close sidebar when clicking outside
  document.addEventListener("click", e => {
    if (!sidebar.contains(e.target) && !menuToggle.contains(e.target) && sidebar.classList.contains("open")) {
      closeSidebar();
    }
  });

  // Close sidebar with ESC key
  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && sidebar.classList.contains("open")) {
      closeSidebar();
    }
  });

  // -------------------- HERO HEADING LETTER ANIMATION --------------------
  const heading = document.getElementById("heroHeading");
  const text = heading.innerText;

  heading.innerHTML = text
    .split("")
    .map((char, i) =>
      `<span style="animation-delay:${i * 0.12}s">${char === " " ? "&nbsp;" : char}</span>`
    )
    .join("");

</script>

</body>
</html>
