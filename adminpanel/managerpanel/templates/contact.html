{% extends 'dashboard.html' %}
{% load static %}
{% block title %}Contact | Dashboard{% endblock title %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages.css' %}" />
{% endblock extra_css %}

{% block content %}
<main class="main-wrapper">

    <!-- ======================
         DISPLAY MESSAGES
    ====================== -->
    {% if messages %}
    <div class="messages card-animation">
        {% for message in messages %}
        <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Page heading -->
    <section class="page-heading card-animation">
        <div class="image-background"></div>
        <div class="fade-overlay"></div>
        <h1 id="pageTitle">Make the Home Page Shine</h1>
    </section>

    <!-- ======================
         SINGLE FORM FOR BOTH CARDS
    ====================== -->
    <form method="POST" enctype="multipart/form-data" class="form-cards card-animation" action="{% url 'update_contact' %}">
        {% csrf_token %}

        <!-- Banner Section -->
        <section class="banner-section">
            <div class="banner-content">
                <h2 class="banner-label">Choose Your Banner Type</h2>
                <div class="type-buttons">
                    <button type="button" class="type-btn {% if page.banner_type == 'image' %}active{% endif %}" data-type="image">Image</button>
                    <button type="button" class="type-btn {% if page.banner_type == 'video' %}active{% endif %}" data-type="video">Video</button>
                </div>
            </div>

            <!-- Hidden input to store selected banner type -->
            <input type="hidden" name="banner_type" id="bannerTypeInput" value="{{ page.banner_type }}">

            <div class="upload-container animate-in" id="bannerUploader">
                <!-- Video Background -->
                <div class="background-video">
                    <video autoplay muted loop id="bgVideo">
                        {% if page.banner_type == 'video' and page.banner_file %}
                        <source src="{{ page.banner_file.url }}" type="video/mp4">
                        {% else %}
                        <source src="{% static 'videos/background.mp4' %}" type="video/mp4">
                        {% endif %}
                    </video>
                    <div class="overlay"></div>
                </div>

                <!-- Uploader / Basket -->
                <div class="uploader basket" id="uploader">
                    <!-- Basket Icon -->
                    <div class="basket-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M9 6V4h6v2M5 6l1 14h12l1-14H5z"></path>
                            <path d="M9 12v6M15 12v6"></path>
                        </svg>
                    </div>

                    <!-- Drag & drop hint -->
                    <div class="drop-hint">Drag & drop your file here — or click to browse</div>

                    <!-- Hidden file input -->
                    <input type="file" id="fileInput" accept="image/*,video/*" />

                    <!-- Preview area -->
                    <div class="preview-area" id="previewArea">
                        {% if page.banner_type == 'image' and page.banner_file %}
                        <img src="{{ page.banner_file.url }}" alt="Current Banner">
                        {% elif page.banner_type == 'video' and page.banner_file %}
                        <video src="{{ page.banner_file.url }}" controls></video>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <!-- Content Editor Section -->
        <section class="content-editor">
            <div class="editor-card">
                <h3>Update Page Content</h3>
                <div class="form-group">
                    <label for="editHeading">Page Heading</label>
                    <input id="editHeading" type="text" name="heading" value="{{ page.heading }}" />
                </div>
                <div class="form-group">
                    <label for="editDesc">Page Description</label>
                    <textarea id="editDesc" name="description" rows="4">{{ page.description }}</textarea>
                </div>
            </div>
        </section>

        <!-- Save Section -->
        <section class="save-section">
            <button type="submit" class="btn save-btn">Save Changes</button>
        </section>
    </form>
</main>

<!-- =========================
     JS FOR ANIMATION + PREVIEW
========================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {

    /* =====================================================
       ✅ Smooth Page Load Animation
    ===================================================== */
    document.body.classList.add("page-loaded"); 
    // Make sure to add CSS for `page-loaded` (I'll provide if needed)

    /* =====================================================
       ✅ Scroll animations (original)
    ===================================================== */
    const observerOptions = {
        root: null,
        rootMargin: '100px 0px',
        threshold: 0.05
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const el = entry.target;

            if(entry.isIntersecting){
                if(el.classList.contains('messages')) {
                    const children = el.querySelectorAll('.message');
                    children.forEach((child, index) => {
                        setTimeout(() => {
                            child.classList.add('animate-in');
                        }, index * 150);
                    });
                }
                el.classList.add('animate-in');
            }
        });
    }, observerOptions);

    const animateElements = document.querySelectorAll(
        '.card-animation, .page-heading, .banner-section, .upload-container, .content-editor'
    );
    animateElements.forEach(el => observer.observe(el));

    /* =====================================================
       ✅ Banner preview logic (original)
    ===================================================== */
    const fileInput = document.getElementById('fileInput');
    const previewArea = document.getElementById('previewArea');
    const bgVideo = document.getElementById('bgVideo');
    const bannerTypeInput = document.getElementById('bannerTypeInput');

    fileInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if(!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            const ext = file.name.split('.').pop().toLowerCase();
            previewArea.innerHTML = '';
            if(ext === 'mp4' || ext === 'webm') {
                bgVideo.src = event.target.result;
                bgVideo.style.display = 'block';
            } else {
                const img = document.createElement('img');
                img.src = event.target.result;
                previewArea.appendChild(img);
                bgVideo.style.display = 'none';
            }
        }
        reader.readAsDataURL(file);
    });

    /* =====================================================
       ✅ Banner type toggle (original)
    ===================================================== */
    const typeButtons = document.querySelectorAll('.type-btn');
    typeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            typeButtons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            bannerTypeInput.value = btn.dataset.type;
        });
    });

    /* =====================================================
       ✅ Additional heading observer (original)
    ===================================================== */
    const headingElements = document.querySelectorAll('.page-heading h1, .banner-label, .editor-card h3');
    headingElements.forEach(heading => {
        observer.observe(heading);
    });

    /* =====================================================
       ✅ Drag & Drop Upload Support
       Fix: Clicking container opens File Select Window
    ===================================================== */
    const uploadContainer = document.querySelector(".upload-container");

    uploadContainer.addEventListener("click", () => {
        fileInput.click();
    });

    uploadContainer.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadContainer.classList.add("dragging");
    });

    uploadContainer.addEventListener("dragleave", () => {
        uploadContainer.classList.remove("dragging");
    });

    uploadContainer.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadContainer.classList.remove("dragging");

        const file = e.dataTransfer.files[0];
        fileInput.files = e.dataTransfer.files;

        const event = new Event("change");
        fileInput.dispatchEvent(event);
    });
});
</script>


{% endblock content %}
